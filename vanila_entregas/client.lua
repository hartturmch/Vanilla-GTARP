local Tunnel = module("vrp","lib/Tunnel")
local Proxy = module("vrp","lib/Proxy")
func = Tunnel.getInterface("vanila_entregas")
-----------------------------------------------------------------------------------------------------------------------------------------
-- VARIAVEIS
-----------------------------------------------------------------------------------------------------------------------------------------
local blips = false
local servico = false
local selecionado = 0
local CoordenadaX = 93.25
local CoordenadaY = -1291.82
local CoordenadaZ = 29.26

-----------------------------------------------------------------------------------------------------------------------------------------
-- RESIDENCIAS
-----------------------------------------------------------------------------------------------------------------------------------------
local locs = {
	[1] = { ['x'] = -2974.03, ['y'] = 482.67, ['z'] = 14.92},
	[2] = { ['x'] = 1705.57, ['y'] = 4799.57, ['z'] = 41.80},
	[3] = { ['x'] = -133.45, ['y'] = -1580.70, ['z'] = 34.20},
	[4] = { ['x'] = -1087.92, ['y'] = -1671.92, ['z'] = 4.70},
	[5] = { ['x'] = 2326.62, ['y'] = 235.85, ['z'] = 197.90},
	[6] = { ['x'] = 1286.81, ['y'] = -1604.55, ['z'] = 54.82},
	[7] = { ['x'] = 1396.39, ['y'] = -768.17, ['z'] = 73.88},
	[8] = { ['x'] = 1550.13, ['y'] = -82.77, ['z'] = 157.27},
	[9] = { ['x'] = 1841.74, ['y'] = 223.97, ['z'] = 166.68},
	[10] = { ['x'] = 1191.11, ['y'] = -1691.57, ['z'] = 35.83},
	[11] = { ['x'] = -668.13, ['y'] = -970.18, ['z'] = 22.34},
	[12] = { ['x'] = -1161.85, ['y'] = -1099.05, ['z'] = 2.17},
	[13] = { ['x'] = -230.55, ['y'] = -2048.74, ['z'] = 27.23},
	[14] = { ['x'] = -1040.90, ['y'] = -2718.84, ['z'] = 13.29},
	[15] = { ['x'] = -938.13, ['y'] = -2324.90, ['z'] = 6.32},
	[16] = { ['x'] = -1416.60, ['y'] = -527.60, ['z'] = 31.24},
	[17] = { ['x'] = -797.59, ['y'] = -115.62, ['z'] = 37.47},
	[18] = { ['x'] = -1087.20, ['y'] = 479.49, ['z'] = 81.52},
	[19] = { ['x'] = -1215.48, ['y'] = 457.80, ['z'] = 91.97},
	[20] = { ['x'] = -1277.36, ['y'] = 496.79, ['z'] = 97.80},
	[21] = { ['x'] = -1380.82, ['y'] = 474.51, ['z'] = 105.05},
	[22] = { ['x'] = -1063.64, ['y'] = -1054.95, ['z'] = 2.15},
	[23] = { ['x'] = -1221.21, ['y'] = -318.98, ['z'] = 37.16},
	[24] = { ['x'] = -2974.03, ['y'] = 482.67, ['z'] = 14.92},
	[25] = { ['x'] = 219.73, ['y'] = 205.29, ['z'] = 105.06},
	[26] = { ['x'] = 152.94, ['y'] = -1029.80, ['z'] = 28.86},
	[27] = { ['x'] = -1087.20, ['y'] = 479.49, ['z'] = 81.52},
	[28] = { ['x'] = -1215.48, ['y'] = 457.80, ['z'] = 91.97},
	[29] = { ['x'] = -1161.85, ['y'] = -1099.05, ['z'] = 2.17},
	[30] = { ['x'] = -1172.09, ['y'] = -1571.91, ['z'] = 4.66},
	[31] = { ['x'] = -64.48, ['y'] = -1450.00, ['z'] = 32.52},
	[32] = { ['x'] = -1087.92, ['y'] = -1671.92, ['z'] = 4.70},
	[33] = { ['x'] = 1286.81, ['y'] = -1604.55, ['z'] = 54.82},
	[34] = { ['x'] = -766.07, ['y'] = -917.12, ['z'] = 21.09},
	[35] = { ['x'] = 981.49, ['y'] = -1805.61, ['z'] = 35.48},
	[36] = { ['x'] = 852.84, ['y'] = -309.42, ['z'] = 64.95},
	[37] = { ['x'] = 793.37, ['y'] = -215.86, ['z'] = 65.61},
	[38] = { ['x'] = 768.42, ['y'] = -206.46, ['z'] = 70.121},
	[39] = { ['x'] = 652.29, ['y'] = -294.54, ['z'] = 48.61},
	[40] = { ['x'] = -1122.75, ['y'] = -1557.40, ['z'] = 5.4042},
	[41] = { ['x'] = -1134.71, ['y'] = -1568.79, ['z'] = 4.40},
	[42] = { ['x'] = -1155.83, ['y'] = -1574.05, ['z'] = 8.34},
	[43] = { ['x'] = -1165.08, ['y'] = -1586.68, ['z'] = 4.38},
	[44] = { ['x'] = -1167.65, ['y'] = -1584.0, ['z'] = 4.38},
	[45] = { ['x'] = -1170.94, ['y'] = -1579.11, ['z'] = 4.38},
	[46] = { ['x'] = -1174.64, ['y'] = -1574.52, ['z'] = 4.37},
	[47] = { ['x'] = -1177.52, ['y'] = -1568.80, ['z'] = 4.35},
	[48] = { ['x'] = -1182.70, ['y'] = -1561.23, ['z'] = 4.35},
	[49] = { ['x'] = -1183.07, ['y'] = -1556.66, ['z'] = 5.04},
	[50] = { ['x'] = -1187.78, ['y'] = -1554.96, ['z'] = 4.36},
	[51] = { ['x'] = -1150.75, ['y'] = -1519.55, ['z'] = 4.35},
	[52] = { ['x'] = -1148.41, ['y'] = -1523.61, ['z'] = 10.62},
	[53] = { ['x'] = -1150.05, ['y'] = -1521.91, ['z'] = 10.62},
	[54] = { ['x'] = -1142.77, ['y'] = -1520.96, ['z'] = 4.35},
	[55] = { ['x'] = -1224.71, ['y'] = -1486.89, ['z'] = 4.33},
	[56] = { ['x'] = -1221.72, ['y'] = -1469.42, ['z'] = 4.32},
	[57] = { ['x'] = -1210.85, ['y'] = -1461.79, ['z'] = 4.33},
	[58] = { ['x'] = -1218.86, ['y'] = -1433.79, ['z'] = 4.33},
	[59] = { ['x'] = -1226.94, ['y'] = -1438.63, ['z'] = 4.335},
	[60] = { ['x'] = -1251.65, ['y'] = -1449.44, ['z'] = 4.34},
	[61] = { ['x'] = -1256.72, ['y'] = -1441.53, ['z'] = 4.34},
	[62] = { ['x'] = -1259.35, ['y'] = -1438.79, ['z'] = 4.34},
	[63] = { ['x'] = -1268.53, ['y'] = -1421.75, ['z'] = 4.34},
	[64] = { ['x'] = -1276.20, ['y'] = -1410.94, ['z'] = 4.32},
	[65] = { ['x'] = -1273.68, ['y'] = -1382.22, ['z'] = 4.32},
	[66] = { ['x'] = -1298.82, ['y'] = -1378.19, ['z'] = 4.48},
	[67] = { ['x'] = -1332.69, ['y'] = -1215.29, ['z'] = 5.94},
	[68] = { ['x'] = -1321.30, ['y'] = -1169.59, ['z'] = 4.82},
	[69] = { ['x'] = -1289.11, ['y'] = -1116.65, ['z'] = 6.94},
	[70] = { ['x'] = -1275.61, ['y'] = -1139.54, ['z'] = 6.79},
	[71] = { ['x'] = -1270.92, ['y'] = -1148.55, ['z'] = 6.78},
	[72] = { ['x'] = -1241.73, ['y'] = -1208.17, ['z'] = 8.51},
	[73] = { ['x'] = -1244.07, ['y'] = -1240.08, ['z'] = 11.02},
	[74] = { ['x'] = -1168.39, ['y'] = -1267.17, ['z'] = 6.19},
	[75] = { ['x'] = -1038.80, ['y'] = -1397.64, ['z'] = 5.55},
	[76] = { ['x'] = -5.59, ['y'] = 30.47, ['z'] = 71.29},
	[77] = { ['x'] = -51.20, ['y'] = 52.56, ['z'] = 72.27},
	[78] = { ['x'] = -101.67, ['y'] = 45.80, ['z'] = 71.62},
	[79] = { ['x'] = -81.19, ['y'] = 91.37, ['z'] = 71.56},
	[80] = { ['x'] = -212.27, ['y'] = 133.35, ['z'] = 69.63},
	[81] = { ['x'] = -303.94, ['y'] = 103.36, ['z'] = 67.91},
	[82] = { ['x'] = -313.84, ['y'] = 105.63, ['z'] = 67.60},
	[83] = { ['x'] = -389.55, ['y'] = 139.00, ['z'] = 65.62},
	[84] = { ['x'] = -806.66, ['y'] = -97.08, ['z'] = 37.57},
	[85] = { ['x'] = -355.53, ['y'] = -28.17, ['z'] = 47.26},
	[86] = { ['x'] = 908.17, ['y'] = -2265.30, ['z'] = 30.64},
	[87] = { ['x'] = 1048.71, ['y'] = -2423.84, ['z'] = 30.30},
	[88] = { ['x'] = 1005.94, ['y'] = -2067.30, ['z'] = 31.1},
	[89] = { ['x'] = 894.48, ['y'] = -1730.09, ['z'] = 30.33},
	[90] = { ['x'] = 787.04, ['y'] = -1324.03, ['z'] = 26.07},
	[91] = { ['x'] = 775.82, ['y'] = -1054.89, ['z'] = 27.03},
	[92] = { ['x'] = 760.25, ['y'] = -732.10, ['z'] = 27.76},
	[93] = { ['x'] = 522.34, ['y'] = -162.59, ['z'] = 56.14},
	[94] = { ['x'] = 617.49, ['y'] = 70.49, ['z'] = 90.73},
	[95] = { ['x'] = 446.33, ['y'] = 131.26, ['z'] = 99.76},
	[96] = { ['x'] = -216.42, ['y'] = 276.42, ['z'] = 92.04},
	[97] = { ['x'] = -518.22, ['y'] = 270.36, ['z'] = 83.05},
	[98] = { ['x'] = -1249.96, ['y'] = 459.96, ['z'] = 93.49},
	[99] = { ['x'] = -1146.81, ['y'] = -1379.54, ['z'] = 4.86},
	[100] = { ['x'] = -1076.43, ['y'] = -1499.54, ['z'] = 5.10},
	[101] = { ['x'] = -1025.47, ['y'] = -1589.37, ['z'] = 5.16},
	[102] = { ['x'] = -1090.09, ['y'] = -1538.90, ['z'] = 4.52},
	[103] = { ['x'] = -1132.08, ['y'] = -1502.39, ['z'] = 4.38},
	[104] = { ['x'] = -1251.66, ['y'] = -1280.10, ['z'] = 3.99},
	[105] = { ['x'] = -1324.01, ['y'] = -1086.32, ['z'] = 6.95},
	[106] = { ['x'] = -1280.01, ['y'] = -642.26, ['z'] = 26.72},
	[107] = { ['x'] = -1237.54, ['y'] = -555.11, ['z'] = 28.85},
	[108] = { ['x'] = -1304.85, ['y'] = -317.67, ['z'] = 37.00},
	[109] = { ['x'] = -1388.69, ['y'] = -271.16, ['z'] = 43.11},
	[110] = { ['x'] = -768.64, ['y'] = 313.04, ['z'] = 85.69},
	[111] = { ['x'] = -634.50, ['y'] = 139.82, ['z'] = 57.23},
	[112] = { ['x'] = -623.54, ['y'] = -201.87, ['z'] = 37.45},
	[113] = { ['x'] = -617.12, ['y'] = -439.37, ['z'] = 34.76},
	[114] = { ['x'] = -162.29, ['y'] = -873.28, ['z'] = 29.23},
	[115] = { ['x'] = -766.75, ['y'] = 296.88, ['z'] = 85.66},
	[116] = { ['x'] = 308.27, ['y'] = 171.07, ['z'] = 103.94},
	[117] = { ['x'] = 425.90, ['y'] = 99.60, ['z'] = 100.21},
	[118] = { ['x'] = 142.54, ['y'] = -823.80, ['z'] = 31.14},
	[119] = { ['x'] = 115.45, ['y'] = -929.64, ['z'] = 29.84},
	[120] = { ['x'] = 245.75, ['y'] = -1065.43, ['z'] = 29.29},
	[121] = { ['x'] = 296.63, ['y'] = -1072.45, ['z'] = 29.40},
	[122] = { ['x'] = 392.63, ['y'] = -972.23, ['z'] = 29.44},
	[123] = { ['x'] = 433.24, ['y'] = -983.10, ['z'] = 30.71},
	[124] = { ['x'] = 379.89, ['y'] = -683.63, ['z'] = 29.25},
	[125] = { ['x'] = 294.75, ['y'] = -807.74, ['z'] = 29.44},
	[126] = { ['x'] = -188.88, ['y'] = -1425.62, ['z'] = 31.50},
	[127] = { ['x'] = -1168.01, ['y'] = -1478.40, ['z'] = 4.37},
	[128] = { ['x'] = -1294.20, ['y'] = -1163.08, ['z'] = 4.99},
	[129] = { ['x'] = -1366.10, ['y'] = -685.89, ['z'] = 25.10},
	[130] = { ['x'] = -254.03, ['y'] = 6149.25, ['z'] = 31.51},
	[131] = { ['x'] = 413.10, ['y'] = 6539.25, ['z'] = 27.73},
	[132] = { ['x'] = 770.05, ['y'] = 5578.29, ['z'] = 33.48},
	[133] = { ['x'] = 1736.97, ['y'] = 3290.91, ['z'] = 41.14},
	[134] = { ['x'] = 1954.24, ['y'] = 3843.53, ['z'] = 32.02},
	[135] = { ['x'] = 2516.32, ['y'] = 4203.18, ['z'] = 39.99},
	[136] = { ['x'] = 2906.71, ['y'] = 4407.69, ['z'] = 50.22}
}
-----------------------------------------------------------------------------------------------------------------------------------------
-- TRABALHAR
-----------------------------------------------------------------------------------------------------------------------------------------
Citizen.CreateThread(function()
	while true do
		Citizen.Wait(1)
		if not servico then
			local ped = PlayerPedId()
			local x,y,z = table.unpack(GetEntityCoords(ped))
			local bowz,cdz = GetGroundZFor_3dCoord(CoordenadaX,CoordenadaY,CoordenadaZ)
			local distance = GetDistanceBetweenCoords(CoordenadaX,CoordenadaY,cdz,x,y,z,true)

			if distance <= 30.0 then
				DrawMarker(23,CoordenadaX,CoordenadaY,CoordenadaZ-0.97,0,0,0,0,0,0,1.0,1.0,0.5,240,200,80,50,0,0,0,0)
				if distance <= 1.2 then
					drawTxt("PRESSIONE  ~b~E~w~  PARA INICIAR ENTREGAS",4,0.5,0.93,0.50,255,255,255,180)
					if IsControlJustPressed(0,38) then
						func.Quantidade()
						servico = true
						selecionado = math.random(38)
						CriandoBlip(locs,selecionado)
					end
				end
			end
		end
	end
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- ENTREGAS
-----------------------------------------------------------------------------------------------------------------------------------------
Citizen.CreateThread(function()
	while true do
		Citizen.Wait(1)
		if servico then
			local ped = PlayerPedId()
			local x,y,z = table.unpack(GetEntityCoords(ped))
			local bowz,cdz = GetGroundZFor_3dCoord(locs[selecionado].x,locs[selecionado].y,locs[selecionado].z)
			local distance = GetDistanceBetweenCoords(locs[selecionado].x,locs[selecionado].y,cdz,x,y,z,true)

			if distance <= 30.0 then
				DrawMarker(21,locs[selecionado].x,locs[selecionado].y,locs[selecionado].z+0.30,0,0,0,0,180.0,130.0,2.0,2.0,1.0,240,200,80,20,1,0,0,1)
				if distance <= 2.5 then
					drawTxt("PRESSIONE  ~b~E~w~  PARA ENTREGAR CONVITES",4,0.5,0.93,0.50,255,255,255,180)
					if IsControlJustPressed(0,38) then
						if func.checkPayment() then
							RemoveBlip(blips)
							backentrega = selecionado
							while true do
								if backentrega == selecionado then
									selecionado = math.random(38)
								else
									break
								end
								Citizen.Wait(1)
							end
							func.Quantidade()
							CriandoBlip(locs,selecionado)
						end
					end
				end
			end
		end
	end
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- CANCELAR
-----------------------------------------------------------------------------------------------------------------------------------------
Citizen.CreateThread(function()
	while true do
		Citizen.Wait(1)
		if servico then
			if IsControlJustPressed(0,168) then
				servico = false
				RemoveBlip(blips)
			end
		end
	end
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- FUNÇÕES
-----------------------------------------------------------------------------------------------------------------------------------------
function drawTxt(text,font,x,y,scale,r,g,b,a)
	SetTextFont(font)
	SetTextScale(scale,scale)
	SetTextColour(r,g,b,a)
	SetTextOutline()
	SetTextCentre(1)
	SetTextEntry("STRING")
	AddTextComponentString(text)
	DrawText(x,y)
end

function CriandoBlip(locs,selecionado)
	blips = AddBlipForCoord(locs[selecionado].x,locs[selecionado].y,locs[selecionado].z)
	SetBlipSprite(blips,1)
	SetBlipColour(blips,5)
	SetBlipScale(blips,0.4)
	SetBlipAsShortRange(blips,false)
	SetBlipRoute(blips,true)
	BeginTextCommandSetBlipName("STRING")
	AddTextComponentString("Entrega de Convites")
	EndTextCommandSetBlipName(blips)
end